<!DOCTYPE html>
<html>
<head>
   <meta charset="UTF-8">
   <title>Insert title here</title>

   <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
   <script type="text/javascript" src="js/jquery-1.12.4.min.js"></script>
   <script type="text/javascript" src="js/bootstrap.min.js"></script>
	<style type="text/css">
	.navbar{
		border-bottom:1px solid gray;
	}
		.navbar-brand img{
			height:100%;
		}
	</style>
   <script type="text/javascript">
   $(window).on=('popstate',function(e){
	   if(location.hash==''||location.hash=='#home'){
		   $('.navbar a').eq(0).click();
	   }else if(location.hash=='#emp'){
		   $('.navbar a').eq(1).click();
	   }
   });
   var popup2;
   var popup2Init=function(){
   	popup2.find('input').prop('readonly',true);
   	popup2.find('button').eq(1).html("수정").one('click',function(e){
   		popup2.find('input').filter(':gt(0)').removeProp('readonly');
   		return false;
   	});
    popup2.find('button').eq(2).html("삭제").toggleClass('btn-default').addClass('btn-danger').one('click', function(e){
        $.post('api/empDel.json','empno='+popup2.find('input:eq(0)').val(),function(){
           popup2.modal('hide');
           $('.navbar a').eq(1).click();
        });
        return false;
     });
   };
      $(function(){
    	  //모달 복사하기 - 상세페이지
    	  popup2=$('#myModal').clone();
    	  popup2.find('h4').html('상세페이지');
    	  popup2Init();
    	  //상세페이지 모달에서 수정 버튼을 클릭하면 
    	 popup2.find('form').submit(function(e){
			e.preventDefault();
			var param=$(e.target).serialize();
			$.ajax({
				url:'api/empUpdate.json',
				type:'post',
				data:param,
				error:function(){
					
				},
				success:function(){
					popup2.modal('hide');
	        		 $('.navbar a').eq(1).click();
				}
			});
		});
    	  
    	  
    	  
    	  
         $('.carousel').carousel({
            interval: 2000
         });
         
         $('#content>div').hide().first().show();
         $('.navbar a').first().click(function(e){
        	 e.prevent
        	 $('#content>div').hide().filter('#p1').show();
         });
         $('.navbar a').eq(1).click(function(e){
        	 $('#content>div').hide().filter('#p2').show();
        	 //JSON데이터 가져오기
        	 $.getJSON('api/emps.json',function(data){
        		 //JSON값 가져오기 전에, tbody를 비워둔다. 누적을 방지함.
        		 $('#p2 table>tbody').empty();
        		$(data.emp).each(function(idx,ele){
        			var row=ele;
        			$('<tr/>')
					.append('<td><a href="#'+row.empno+'">'+row.empno+'</a></td>')
					.append('<td><a href="#'+row.empno+'">'+row.ename+'</a></td>')
					.append('<td><a href="#'+row.empno+'">'+row.sal+'</a></td>')
					.appendTo('#p2 table>tbody')
					.find('a').click(function(e){
						var num=e.target.href.substr('http://localhost:8080/web14/#'.length);
						$.getJSON('api/emp.json?empno='+num,function(data){
							popup2.modal('show');
							popup2Init();
							popup2.find('input').eq(0).val(num);
							popup2.find('input').eq(1).val(data.emp[0].ename);
							popup2.find('input').eq(2).val(data.emp[0].sal);
														
						});
					})
					;
        		});
        	 });
         });
         
         //form에서 submit버튼을 누를 경우
         $('#myModal form').submit(function(e){
        	 e.preventDefault();//이벤트를 막는다.
        	 $('#myModal h4').html('입력페이지');
        	 var param=$(e.target).serialize();
        	 //post방식으로 보냄
        	 $.post('api/addemp.json', param, function(data){
        		 if(data.insert[0].result){//성공이면
	        		 $('#myModal').modal('hide');
	        		 $('.navbar a').eq(1).click();
	        		 $('#myModal input').val('');
        		 }else{
        			 $('#myModal h4').html('입력페이지<small>'+data.insert[0].err+'</small>');
        		 }
        	 },'json');
        	
         });
         
         
         
      });   
   </script>
</head>
<body>

<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="#home">
        <img alt="Brand" src="imgs/logo.jpg">
      </a>
    </div>
    <p class="navbar-text"><a href="#emp">EMP</a></p>
  </div>
</nav>
<div class="container">
   <div id="content" class="row">
      <div id="p1" class="col-md-12">
         <!-- content start -->
         
         <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
           <!-- Indicators -->
           <!-- <ol class="carousel-indicators">
             <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
             <li data-target="#carousel-example-generic" data-slide-to="1"></li>
             <li data-target="#carousel-example-generic" data-slide-to="2"></li>
           </ol> -->
         
           <!-- Wrapper for slides -->
           <div class="carousel-inner" role="listbox">
			    <div class="item active">
			      <img src="imgs/index.png" alt="...">
			      <div class="carousel-caption">...</div>
			    </div>
			     <div class="item">
			      <img src="imgs/index2.png" alt="...">
			      <div class="carousel-caption">...</div>
			    </div>
			     <div class="item">
			     <img src="imgs/index3.png" alt="..."> 
			      <div class="carousel-caption">...</div>
			    </div>
		  </div>
         
           <!-- Controls -->
           <!-- <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
             <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
             <span class="sr-only">Previous</span>
           </a>
           <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
             <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
             <span class="sr-only">Next</span>
           </a> -->
         </div>
         
         <!-- content end -->
      </div>
      <div id="p2" class="col-md-12">
         <div class="jumbotron">
           <h1>EMP PAGE</h1>
           <p><a class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal"href="#add" role="button">입력</a></p>
         </div>
         <table class="table">
            <thead>
               <tr>
                  <th>empno</th>
                  <th>ename</th>
                  <th>sal</th>
               </tr>
            </thead>
            <tbody></tbody>
         </table>
      </div>
   </div>
   <div id="footer" class="row">
      <div class="col-md-12">
         <address>
            <strong>Twitter, Inc.</strong><br>
            1355 Market Street, Suite 900<br>
              San Francisco, CA 94103<br>
            <abbr title="Phone">P:</abbr> (123) 456-7890
         </address>
      </div>
   </div>
</div>



<!-- start add modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">입력페이지</h4>
      </div>
      <div class="modal-body text-right">
        <form action="#add" method="post">
        	<div class="form-group">
        		<label for="empno">empno</label>
        		<input type="text" name="empno" id="empno" class="form-control" placeholder="empno"/>
        	</div>
        	<div class="form-group">
        		<label for="ename">ename</label>
        		<input type="text" name="ename" id="ename"  class="form-control" placeholder="ename"/>
        	</div>
        	<div class="form-group">
        		<label for="sal">sal</label>
        		<input type="text" name="sal" id="sal" class="form-control" placeholder="sal"/>
        	</div >
        	<div class="form-group">
       			<button type="submit" class="btn btn-primary" >입력</button>
       			<button type="reset" class="btn btn-default">취소</button>
       			<button type="button" class="btn btn-default" data-dismiss="modal">뒤로</button>
        	</div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- end add modal -->

</body>
</html>